---
import StoryLayout from '../../layouts/StoryLayout.astro';
import stories from '../../data/stories.json';

const story = stories.find(s => s.slug === 'amazon-resume-ai')!;
---

<style is:global>
  .resume-card {
    background: #f5f5f0;
    border: 1px solid #ccc;
    border-radius: 0.5rem;
    padding: 2rem;
    margin: 2rem 0;
    color: #1a1a1a;
    font-family: Georgia, serif;
    position: relative;
  }
  .resume-name { font-size: 1.3rem; font-weight: 700; margin-bottom: 0.25rem; }
  .resume-contact { font-size: 0.78rem; color: #666; margin-bottom: 1.5rem; }
  .resume-section { margin-bottom: 1.5rem; }
  .resume-section h4 { font-size: 0.72rem; letter-spacing: 0.15em; text-transform: uppercase; color: #666; border-bottom: 1px solid #ccc; padding-bottom: 0.25rem; margin-bottom: 0.75rem; }
  .resume-item { margin-bottom: 0.75rem; font-size: 0.88rem; line-height: 1.5; }
  .resume-item .flagged { background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.3); border-radius: 0.25rem; padding: 0.15rem 0.35rem; position: relative; }
  .resume-item .flag-note { display: inline-block; background: #ef4444; color: white; font-size: 0.6rem; font-family: system-ui; border-radius: 0.2rem; padding: 0.1rem 0.35rem; margin-left: 0.35rem; vertical-align: middle; font-weight: 700; letter-spacing: 0.05em; }
  .resume-score {
    position: absolute; top: 1.5rem; right: 1.5rem;
    background: #1a1a1a; color: white; border-radius: 0.5rem;
    padding: 0.75rem 1rem; text-align: center;
    font-family: system-ui;
  }
  .score-stars { font-size: 1.2rem; color: var(--story); }
  .score-label { font-size: 0.65rem; color: #888; display: block; margin-top: 0.2rem; }

  .bias-list { margin: 2rem 0; display: flex; flex-direction: column; gap: 0.75rem; }
  .bias-item { background: var(--surface); border: 1px solid var(--border); border-left: 3px solid var(--story); border-radius: 0 0.5rem 0.5rem 0; padding: 1.25rem 1.5rem; }
  .bias-item .bi-type { font-size: 0.68rem; letter-spacing: 0.12em; text-transform: uppercase; color: var(--story); margin-bottom: 0.4rem; }
  .bias-item .bi-desc { font-size: 0.9rem; color: #c0c0c0; }

  @media (max-width: 600px) {
    .resume-score { position: static; margin-top: 1rem; text-align: left; display: inline-block; }
  }

  .phantom-wrap { width: 100%; margin: 0; line-height: 0; }
  .amazon-canvas { display: block; width: 100%; height: 380px; background: var(--bg); }
</style>

<StoryLayout story={story}>
  <div class="container">

<section class="section" id="idea">
  <h2><span class="num">01 — The Idea</span>Automating the Hiring Funnel</h2>
  <p>In 2014, Amazon's machine learning team had an idea that seemed almost obviously good: automate resume screening. Amazon received hundreds of thousands of job applications every year. Human recruiters were a bottleneck. If an AI could learn what made a great Amazon employee — by analyzing successful hires from the past decade — it could process thousands of applications instantly, ranking candidates on a five-star scale.</p>
  <p>The team began training the model on a decade's worth of resumes submitted to Amazon. There was a problem embedded in the training data that nobody fully appreciated at first: over the previous ten years, most Amazon employees in technical roles had been men. The tech industry skews male. Amazon skewed male. The AI was about to learn from that.</p>

  <div class="stat-cards">
    <div class="stat-card"><div class="stat-num">2014</div><div class="stat-label">Project begins</div></div>
    <div class="stat-card"><div class="stat-num">2015</div><div class="stat-label">Bias discovered</div></div>
    <div class="stat-card"><div class="stat-num">2017</div><div class="stat-label">Quietly scrapped</div></div>
    <div class="stat-card"><div class="stat-num">2018</div><div class="stat-label">Reuters exposes it</div></div>
  </div>
</section>

<div class="phantom-wrap">
  <canvas class="amazon-canvas" aria-hidden="true"></canvas>
</div>
<p class="canvas-note"><strong>The Filter</strong> — Résumé terms drift downward. Six phrases are flagged amber, slowed, and branded with a penalty. The algorithm never saw the person — only the words.</p>

<section class="section" id="discovery">
  <h2><span class="num">02 — The Discovery</span>The Model Hated Women's Resumes</h2>
  <p>By 2015, Amazon's engineers realized something was wrong. The model wasn't rating candidates in a gender-neutral way. It was <strong>actively penalizing resumes</strong> that included the word "women's" — as in "captain of women's chess team," "president of women's professional association," or "attended women's college."</p>

  <div class="resume-card">
    <div class="resume-score">
      <div class="score-stars">★★☆☆☆</div>
      <span class="score-label">AI SCORE</span>
    </div>
    <div class="resume-name">Jane Candidate</div>
    <div class="resume-contact">jane@email.com · linkedin.com/in/janecandidate</div>
    <div class="resume-section">
      <h4>Education</h4>
      <div class="resume-item">B.A. Computer Science, <span class="flagged">Wellesley College<span class="flag-note">⚠ PENALIZED</span></span> (all-women's college)</div>
    </div>
    <div class="resume-section">
      <h4>Leadership</h4>
      <div class="resume-item">President, <span class="flagged">Women in Technology Society<span class="flag-note">⚠ PENALIZED</span></span></div>
      <div class="resume-item">Captain, <span class="flagged">Women's Varsity Tennis Team<span class="flag-note">⚠ PENALIZED</span></span></div>
    </div>
    <div class="resume-section">
      <h4>Experience</h4>
      <div class="resume-item">Software Engineer Intern, Google (2 summers) ✓</div>
    </div>
  </div>

  <p>The AI had learned from the historical data that men were hired more often, and concluded that female-associated signals were associated with not being hired. It was encoding the company's existing gender imbalance and presenting it as objective hiring criteria.</p>
</section>

<section class="section" id="deeper">
  <h2><span class="num">03 — Deeper</span>The Patterns Kept Coming</h2>
  <p>The more Amazon's engineers investigated, the more bias they found. The AI had learned to prefer <strong>verbs commonly used by men</strong> in technical fields: words like "executed," "captured," and "managed" scored well. Softer language associated with collaboration scored lower. The model had reverse-engineered Amazon's existing gender gap and written it into its scoring system.</p>

  <div class="bias-list">
    <div class="bias-item">
      <div class="bi-type">Word-Level Penalty</div>
      <div class="bi-desc">Resumes containing the word "women's" (in any context — clubs, sports, colleges) received automatic score deductions.</div>
    </div>
    <div class="bias-item">
      <div class="bi-type">Institutional Penalty</div>
      <div class="bi-desc">Graduates of all-women's colleges scored systematically lower than equivalent candidates from co-ed institutions.</div>
    </div>
    <div class="bias-item">
      <div class="bi-type">Language Preference</div>
      <div class="bi-desc">Action verbs statistically more common in male applicants ("executed," "captured") were rewarded; collaborative language was not.</div>
    </div>
    <div class="bias-item">
      <div class="bi-type">Historical Encoding</div>
      <div class="bi-desc">The model had been trained on a decade of hiring decisions, and those decisions reflected the industry's existing gender imbalance. The AI learned that imbalance as a feature, not a bug.</div>
    </div>
  </div>

  <div class="pull-quote">
    "Amazon's computer models were trained to vet applicants by observing patterns in resumes submitted to the company over a 10-year period. Most came from men."
    <cite>— Reuters, October 9, 2018</cite>
  </div>
</section>

<section class="section" id="shutdown">
  <h2><span class="num">04 — The Shutdown</span>A Secret Burial</h2>
  <p>Amazon's engineers tried to fix the biases. They modified the model to remove explicit gender signals. New biases kept appearing — subtler proxies that hadn't been identified. By 2017, the engineering team concluded the model <strong>could not be trusted</strong> to make unbiased hiring decisions, regardless of how many patches they applied.</p>
  <p>They quietly disbanded the project. The tool was removed. No public announcement was made. No press release. No disclosure to regulators. Candidates who had been screened by the system had no idea it had ever existed, or that their applications had been processed through an algorithm that penalized them for being women. Amazon said the tool was never actually used to make final hiring decisions — it had been used experimentally — but the three years of its operation remained a private internal matter until a Reuters investigation changed that.</p>
</section>

<section class="section" id="reveal">
  <h2><span class="num">05 — The Reveal</span>Reuters Reports It</h2>
  <p>On October 9, 2018, Reuters published: <em>"Amazon scraps secret AI recruiting tool that showed bias against women."</em> The story drew immediate global attention. Amazon confirmed the tool had been scrapped, said it was never used in actual hiring decisions, and emphasized that gender was not a factor in its current hiring processes.</p>
  <p>The response from lawmakers, academics, and civil rights organizations was swift. Calls for mandatory auditing of AI hiring tools intensified. The story became foundational to the growing AI ethics and algorithmic accountability movement. It is still cited in AI bias research, hiring discrimination law, and HR technology governance discussions today.</p>

  <div class="timeline">
    <div class="tl-item">
      <div class="tl-date">2014</div>
      <div class="tl-dot"></div>
      <div class="tl-content">
        <div class="tl-title">Project begins</div>
        <div class="tl-text">Amazon ML team starts building AI resume screening tool, trained on 10 years of hiring data</div>
      </div>
    </div>
    <div class="tl-item">
      <div class="tl-date">2015</div>
      <div class="tl-dot"></div>
      <div class="tl-content">
        <div class="tl-title">Bias discovered</div>
        <div class="tl-text">Engineers find model actively penalizing resumes containing "women's" and downgrading all-women's college graduates</div>
      </div>
    </div>
    <div class="tl-item">
      <div class="tl-date">2016</div>
      <div class="tl-dot"></div>
      <div class="tl-content">
        <div class="tl-title">Patch attempts fail</div>
        <div class="tl-text">Engineers modify model to remove explicit gender signals; new bias proxies keep emerging</div>
      </div>
    </div>
    <div class="tl-item">
      <div class="tl-date">2017</div>
      <div class="tl-dot"></div>
      <div class="tl-content">
        <div class="tl-title">Quietly scrapped</div>
        <div class="tl-text">Amazon disbands the project with no public announcement; tool removed from use</div>
      </div>
    </div>
    <div class="tl-item">
      <div class="tl-date">Oct 2018</div>
      <div class="tl-dot"></div>
      <div class="tl-content">
        <div class="tl-title">Reuters publishes investigation</div>
        <div class="tl-text">Full story breaks globally; congressional scrutiny and calls for AI hiring audits begin immediately</div>
      </div>
    </div>
  </div>
</section>

<section class="section" id="legacy">
  <h2><span class="num">06 — Legacy</span>The Mirror Problem</h2>
  <p>The Amazon story illustrates something deeper than one company's mistake. <strong>Any AI system trained on historical data will learn historical patterns</strong> — including historical injustices. Amazon's AI didn't decide to discriminate. It found the statistical signal that had been present in the training data all along: men had been hired more. It assumed that was the goal. It optimized for it.</p>
  <p>The problem of algorithmic bias cannot be solved simply by removing obvious signals like "women's." Bias is encoded in the structure of historical outcomes — in who was hired, promoted, paid, and retained — and any model trained on those outcomes will absorb and replicate those inequities unless explicitly prevented from doing so. Preventing it turns out to be extraordinarily hard.</p>
  <p>Amazon's case became the founding text of algorithmic hiring audits. Today, New York City requires audits of AI hiring tools used within the city. European regulations impose similar requirements. The hiring AI that nobody was supposed to know about has shaped how governments regulate AI employment tools worldwide.</p>
</section>

  </div>
</StoryLayout>

<script>
(function () {
  const canvas = document.querySelector('.amazon-canvas') as HTMLCanvasElement | null;
  if (!canvas) return;
  const ctx = canvas.getContext('2d')!;

  let W = 0, H = 0, animId = 0;

  const PENALIZED_PHRASES = [
    "women's chess team captain",
    "Wellesley College, B.S. '14",
    "Women in Technology Society",
    "girls who code mentor",
    "all-women's honor society",
    "women's leadership program",
  ];

  const NEUTRAL_TERMS = [
    "3+ years Python experience",
    "B.S. Computer Science, MIT '16",
    "AWS certified developer",
    "React, Node.js, TypeScript",
    "agile development methodology",
    "Stanford University '15",
    "software engineering intern",
    "team leadership experience",
    "GPA 3.9 / 4.0",
    "open source contributor",
    "Google summer internship",
    "strong communication skills",
    "deployed to production",
    "3 years industry experience",
    "excellent references available",
    "executed on key deliverables",
    "managed cross-functional team",
    "captured 15% market share",
    "data structures and algorithms",
    "technical interview experience",
    "distributed systems knowledge",
  ];

  function resize(): boolean {
    const rect = canvas!.getBoundingClientRect();
    const nW = Math.round(rect.width * devicePixelRatio);
    const nH = Math.round(rect.height * devicePixelRatio);
    if (nW === W && nH === H) return false;
    W = nW; H = nH;
    canvas!.width = W; canvas!.height = H;
    return true;
  }

  class Ghost {
    x = 0; y = 0; speed = 0; text = ''; fontSize = 0; alpha = 0;
    constructor() { this.reset(true); }
    reset(initial: boolean) {
      this.x = Math.random() * W * 0.88;
      this.y = initial ? Math.random() * H : -20;
      this.speed = (0.18 + Math.random() * 0.28) * devicePixelRatio;
      this.text = NEUTRAL_TERMS[Math.floor(Math.random() * NEUTRAL_TERMS.length)];
      this.fontSize = (10 + Math.random() * 4) * devicePixelRatio;
      this.alpha = 0.04 + Math.random() * 0.04;
    }
    update() {
      this.y += this.speed;
      if (this.y > H + 20) this.reset(false);
    }
    draw() {
      ctx.save();
      ctx.font = `${this.fontSize}px 'Courier New', monospace`;
      ctx.fillStyle = `rgba(232,232,232,${this.alpha})`;
      ctx.fillText(this.text, this.x, this.y);
      ctx.restore();
    }
  }

  type PState = 'waiting' | 'fadeIn' | 'hold' | 'flag' | 'fadeOut';

  class Filtered {
    x = 0; y = 0; speed = 0; fontSize = 0; alpha = 0;
    state: PState = 'waiting';
    flagProgress = 0;
    delay = 0; delayCount = 0;
    cr = 245; cg = 158; cb = 11; // colour channels, start amber

    constructor(readonly name: string, readonly idx: number, readonly total: number) {
      this.reset(true);
    }

    reset(initial: boolean) {
      this.x = (0.04 + Math.random() * 0.28) * W;
      this.speed = 0.6 * devicePixelRatio;
      this.fontSize = 12 * devicePixelRatio;
      this.flagProgress = 0;
      this.delayCount = 0;
      this.cr = 245; this.cg = 158; this.cb = 11;

      if (initial) {
        this.y = H * (0.05 + (this.idx / this.total) * 0.4);
        this.alpha = 0.7 + Math.random() * 0.3;
        this.state = 'hold';
        this.delay = 0;
      } else {
        this.y = -30 * devicePixelRatio;
        this.alpha = 0;
        this.state = 'waiting';
        this.delay = this.idx * 60 + Math.random() * 100;
      }
    }

    update() {
      if (this.state === 'waiting') {
        this.delayCount++;
        if (this.delayCount >= this.delay) this.state = 'fadeIn';
        return;
      }
      this.y += this.speed;
      const triggerY = H * 0.6;

      if (this.state === 'fadeIn') {
        this.alpha = Math.min(1, this.alpha + 0.025);
        if (this.alpha >= 1) this.state = 'hold';
      } else if (this.state === 'hold') {
        if (this.y >= triggerY) this.state = 'flag';
      } else if (this.state === 'flag') {
        // Type in the annotation over ~50 frames; shift colour amber → red
        this.flagProgress = Math.min(1, this.flagProgress + 1 / 50);
        this.cr = Math.round(245 + (255 - 245) * this.flagProgress);
        this.cg = Math.round(158 * (1 - this.flagProgress));
        this.cb = Math.round(11 * (1 - this.flagProgress));
        if (this.flagProgress >= 1) this.state = 'fadeOut';
      } else if (this.state === 'fadeOut') {
        this.alpha = Math.max(0, this.alpha - 0.012);
        if (this.alpha <= 0) this.reset(false);
      }

      if (this.y > H + 60) this.reset(false);
    }

    draw() {
      if (this.state === 'waiting') return;
      ctx.save();
      ctx.globalAlpha = this.alpha;

      // Main phrase
      ctx.font = `${this.fontSize}px 'Courier New', monospace`;
      ctx.fillStyle = `rgb(${this.cr},${this.cg},${this.cb})`;
      ctx.fillText(this.name, this.x, this.y);

      // Annotation types in below the phrase
      if (this.flagProgress > 0) {
        const label = '\u2193 PENALIZED';
        const visible = Math.ceil(label.length * this.flagProgress);
        ctx.font = `bold ${this.fontSize * 0.8}px 'Courier New', monospace`;
        ctx.fillStyle = '#ff4d4d';
        ctx.fillText(label.slice(0, visible), this.x, this.y + this.fontSize * 1.5);
      }

      ctx.restore();
    }
  }

  let ghosts: Ghost[] = [];
  let particles: Filtered[] = [];

  function initParticles() {
    ghosts = Array.from({ length: 35 }, () => new Ghost());
    particles = PENALIZED_PHRASES.map((n, i) => new Filtered(n, i, PENALIZED_PHRASES.length));
  }

  function drawScanLines() {
    const spacing = 26 * devicePixelRatio;
    ctx.strokeStyle = 'rgba(232,232,232,0.018)';
    ctx.lineWidth = 1;
    for (let y = 0; y < H; y += spacing) {
      ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(W, y); ctx.stroke();
    }
  }

  function drawStaticFrame() {
    ctx.clearRect(0, 0, W, H);
    drawScanLines();
    const fs = 12 * devicePixelRatio;
    ctx.font = `${fs}px 'Courier New', monospace`;
    PENALIZED_PHRASES.forEach((name, i) => {
      const x = W * 0.06;
      const y = H * (0.12 + i * (0.74 / (PENALIZED_PHRASES.length - 1)));
      ctx.globalAlpha = 0.75;
      ctx.fillStyle = '#ff4d4d';
      ctx.fillText(name, x, y);
      ctx.font = `bold ${fs * 0.8}px 'Courier New', monospace`;
      ctx.fillText('\u2193 PENALIZED', x, y + fs * 1.5);
      ctx.font = `${fs}px 'Courier New', monospace`;
    });
    ctx.globalAlpha = 1;
  }

  function tick() {
    ctx.clearRect(0, 0, W, H);
    drawScanLines();
    ghosts.forEach(g => { g.update(); g.draw(); });
    particles.forEach(p => { p.update(); p.draw(); });
    animId = requestAnimationFrame(tick);
  }

  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  resize();
  const ro = new ResizeObserver(() => { if (resize()) initParticles(); });
  ro.observe(canvas);
  initParticles();

  if (prefersReduced) {
    drawStaticFrame();
  } else {
    tick();
  }

  window.addEventListener('unload', () => {
    if (animId) cancelAnimationFrame(animId);
    ro.disconnect();
  });
})();
</script>
