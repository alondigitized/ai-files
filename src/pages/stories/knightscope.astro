---
import StoryLayout from '../../layouts/StoryLayout.astro';
import stories from '../../data/stories.json';

const story = stories.find(s => s.slug === 'knightscope')!;
---

<style is:global>
  .incident-report {
    background: var(--surface);
    border: 1px solid var(--border);
    border-top: 3px solid var(--story);
    border-radius: 0.75rem;
    padding: 2rem;
    margin: 2rem 0;
    font-family: 'Courier New', monospace;
  }
  .incident-report .ir-header { font-size: 0.7rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--story); margin-bottom: 1.5rem; }
  .incident-report .ir-row { display: flex; gap: 1rem; margin-bottom: 0.75rem; font-size: 0.85rem; }
  .incident-report .ir-label { color: var(--muted); min-width: 140px; flex-shrink: 0; }
  .incident-report .ir-value { color: var(--text); }

  .social-cards { display: flex; flex-direction: column; gap: 1rem; margin: 2rem 0; }
  .social-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 0.75rem;
    padding: 1.25rem 1.5rem;
    font-size: 0.9rem;
    color: #c0c0c0;
    line-height: 1.55;
    position: relative;
  }
  .social-card::before { content: attr(data-icon); font-size: 1.1rem; margin-right: 0.5rem; }

  .robot-visual {
    background: radial-gradient(ellipse at center, #001a2e 0%, var(--bg) 70%);
    border: 1px solid rgba(56,189,248,0.2);
    border-radius: 1rem;
    padding: 3rem 2rem;
    text-align: center;
    margin: 2rem 0;
    position: relative;
    overflow: hidden;
  }
  .robot-body { font-size: 5rem; display: block; margin-bottom: 0.5rem; filter: drop-shadow(0 8px 20px rgba(56,189,248,0.4)); }
  .robot-caption { font-size: 0.8rem; color: var(--muted); font-style: italic; }
  .water-line {
    position: absolute; bottom: 0; left: 0; right: 0; height: 40%;
    background: linear-gradient(to top, rgba(56,189,248,0.08), transparent);
    border-top: 1px solid rgba(56,189,248,0.15);
  }
  .phantom-wrap { width: 100%; margin: 0; line-height: 0; }
  .knightscope-canvas { display: block; width: 100%; height: 380px; background: var(--bg); }
</style>

<StoryLayout story={story}>
  <div class="container">

<section class="section" id="background">
  <h2><span class="num">01 â€” Background</span>The K5</h2>
  <p>The Knightscope K5 was, in theory, the security guard of the future. Five feet tall, 300 pounds, shaped like a giant egg on wheels, the K5 was designed to patrol commercial and office spaces autonomously. It was equipped with cameras, lidar sensors, and the ability to detect anomalies and alert human operators. Several Washington DC-area businesses had deployed K5 units as a cost-effective alternative to additional human security staff.</p>
  <p>The robots cost about <strong>$7 per hour</strong> to operate â€” less than minimum wage, no benefits, no sick days. They looked vaguely like R2-D2's larger, less communicative cousin. They could read license plates, detect unusual activity, send alerts. What they could not do, as it turned out, was navigate a decorative fountain.</p>
  <div class="stat-cards">
    <div class="stat-card"><div class="stat-num">5 ft</div><div class="stat-label">Height of K5 robot</div></div>
    <div class="stat-card"><div class="stat-num">300 lbs</div><div class="stat-label">Operating weight</div></div>
    <div class="stat-card"><div class="stat-num">$7/hr</div><div class="stat-label">Operating cost</div></div>
    <div class="stat-card"><div class="stat-num">0</div><div class="stat-label">Fountains navigated</div></div>
  </div>
</section>

<section class="section" id="incident">
  <h2><span class="num">02 â€” The Incident</span>Into the Deep</h2>
  <p>On July 17, 2017, at the Washington Harbour complex in Georgetown, the K5 unit was on its regular patrol route. The Washington Harbour is an upscale office, restaurant, and retail complex near the Potomac riverfront. At the center of the complex is a decorative fountain â€” the kind of feature that gives a campus its ambiance. The kind of feature that, one assumes, a security robot would be programmed to avoid.</p>
  <p>At some point during its patrol, the K5 encountered the fountain. Witnesses reported the robot descended the steps and drove directly into the water without hesitation. It continued moving briefly â€” the wheels spinning, the sensors rotating â€” before settling into the basin, half-submerged. Water flooded its chassis. The robot went silent. Its dome-shaped head tilted back toward the sky.</p>

  <div class="robot-visual">
    <span class="robot-body">ðŸ¤–</span>
    <div class="robot-caption">Artist's impression of the Washington Harbour K5, July 17, 2017.</div>
    <div class="water-line"></div>
  </div>

  <div class="incident-report">
    <div class="ir-header">â¬› Incident Report â€” Unit K5-WH-01</div>
    <div class="ir-row"><span class="ir-label">Date:</span><span class="ir-value">July 17, 2017</span></div>
    <div class="ir-row"><span class="ir-label">Location:</span><span class="ir-value">Washington Harbour, Georgetown, Washington DC</span></div>
    <div class="ir-row"><span class="ir-label">Incident type:</span><span class="ir-value">Unplanned aquatic navigation</span></div>
    <div class="ir-row"><span class="ir-label">Obstacle encountered:</span><span class="ir-value">Decorative fountain (steps + water basin)</span></div>
    <div class="ir-row"><span class="ir-label">Robot response:</span><span class="ir-value">Descended steps; entered water; ceased operation</span></div>
    <div class="ir-row"><span class="ir-label">Recovery:</span><span class="ir-value">Removed from fountain by staff; wheeled out on cart</span></div>
    <div class="ir-row"><span class="ir-label">Crimes prevented:</span><span class="ir-value">Unknown</span></div>
    <div class="ir-row"><span class="ir-label">Fountains prevented:</span><span class="ir-value">0</span></div>
  </div>
</section>

<div class="phantom-wrap">
  <canvas class="knightscope-canvas" aria-hidden="true"></canvas>
</div>
<p class="canvas-note"><strong>The Descent</strong> â€” A security robot patrols its assigned perimeter. Then, on one quiet pass, it drifts inward and does not stop. The fountain was not on the map.</p>

<section class="section" id="response">
  <h2><span class="num">03 â€” Response</span>The Internet Reacts</h2>
  <p>Photos of the submerged robot spread quickly on social media. Within hours, Twitter had provided a full eulogy. The internet named the robot <strong>Steve</strong>. Tribute posts were written. Memes proliferated. A parody Twitter account appeared. People discussed Steve's motivations with great seriousness.</p>

  <div class="social-cards">
    <div class="social-card" data-icon="ðŸŒŠ">"Steve the security robot drowned himself today at Washington Harbour. His commitment to the job was noted. Mostly by the fountain." â€” @someuser</div>
    <div class="social-card" data-icon="ðŸ¤–">"First the robots take our jobs, now they're developing depression. We made them in our image." â€” Twitter, July 2017</div>
    <div class="social-card" data-icon="ðŸ’€">"Security robot: deployed to protect property. Destroyed by: fountain. RIP Steve. You were too good for this world." â€” Twitter, July 2017</div>
    <div class="social-card" data-icon="ðŸ˜­">"The robot just wanted to cool off. It's July in DC. Have some empathy." â€” Twitter, July 2017</div>
  </div>

  <p>Reddit threads debated whether Steve had achieved consciousness specifically in order to be unhappy about his job. A petition to "give Steve a proper funeral" collected signatures. Someone built a small memorial near the fountain. The building's staff, to their credit, seemed to find the whole thing as funny as everyone else.</p>
</section>

<section class="section" id="official">
  <h2><span class="num">04 â€” Official Response</span>A Thorough Investigation</h2>
  <p>Knightscope issued a statement: <em>"We are conducting a thorough investigation of the incident."</em> The company said the robot had experienced an "operational incident" and confirmed the unit had been recovered from the fountain. They did not explain what had led the robot to attempt to navigate a decorative water feature. The building's management was presumably also conducting a thorough investigation.</p>

  <div class="pull-quote">
    "The robot had to be wheeled out of the fountain on a cart. It never patrolled again."
    <cite>â€” Washington Harbour building staff, per local reporting</cite>
  </div>

  <p>A Knightscope spokesperson told the Washington Post: "The K5 Autonomous Data Machine lost the debate with a water feature." This was, in fairness, the most honest corporate statement possible. The robot had attempted to navigate a fountain. The fountain had won.</p>
</section>

<section class="section" id="context">
  <h2><span class="num">05 â€” Context</span>The K5's Career</h2>
  <p>Knightscope's K5 robots had been deployed at various shopping malls, office campuses, and events venues across the US. The Washington Harbour unit was not the only one to have notable incidents â€” other K5s had been reported rolling over children's feet at a San Jose shopping mall and blocking police tape at crime scenes. But none achieved quite the cultural footprint of Steve.</p>
  <p>The K5 was designed to be a deterrent â€” visible, rolling, always watching. Whether the Washington Harbour unit had successfully deterred any crimes before its aquatic incident is not documented. What is documented: it was not an effective deterrent for fountains.</p>

  <div class="timeline">
    <div class="tl-item">
      <div class="tl-date">2013</div>
      <div class="tl-dot"></div>
      <div class="tl-content">
        <div class="tl-title">Knightscope founded</div>
        <div class="tl-text">Company launches with vision of autonomous security patrol robots available for $7/hour</div>
      </div>
    </div>
    <div class="tl-item">
      <div class="tl-date">2017</div>
      <div class="tl-dot"></div>
      <div class="tl-content">
        <div class="tl-title">K5 deployed at Washington Harbour</div>
        <div class="tl-text">Unit begins patrol duties at Georgetown office complex</div>
      </div>
    </div>
    <div class="tl-item">
      <div class="tl-date">Jul 17</div>
      <div class="tl-dot"></div>
      <div class="tl-content">
        <div class="tl-title">The incident</div>
        <div class="tl-text">K5 drives into decorative fountain; photos taken; internet names it Steve</div>
      </div>
    </div>
    <div class="tl-item">
      <div class="tl-date">Jul 18</div>
      <div class="tl-dot"></div>
      <div class="tl-content">
        <div class="tl-title">Global coverage</div>
        <div class="tl-text">Washington Post, BBC, Guardian, CNN all cover the drowning robot; Steve becomes a meme</div>
      </div>
    </div>
    <div class="tl-item">
      <div class="tl-date">Forever</div>
      <div class="tl-dot"></div>
      <div class="tl-content">
        <div class="tl-title">Steve lives on</div>
        <div class="tl-text">Cited in robotics safety papers, AI ethics lectures, and "autonomous systems gone wrong" compilations to this day</div>
      </div>
    </div>
  </div>
</section>

<section class="section" id="legacy">
  <h2><span class="num">06 â€” Legacy</span>What Steve Taught Us</h2>
  <p>The image of a 300-pound security robot lying face-up in a decorative fountain became one of the defining images of early robotics deployment. It joined a small canon of robot failure moments â€” Boston Dynamics tests where robots fall over, Roombas stuck in corners â€” that humanized autonomous systems in a way no corporate press release could.</p>
  <p>Steve was cited in robotics safety papers as a case study in environmental detection and edge-case navigation failure. Knightscope updated its obstacle avoidance systems. Future K5 deployments were presumably given fountain awareness. The broader lesson: autonomous systems need to know what they don't know. The K5 had been tested extensively in parking lots and office corridors. Nobody had thought to test it on steps leading into water.</p>
  <p>Steve's memory lives on. For a brief moment in July 2017, a drowning robot reminded the world that the path to autonomous intelligence is paved with decorative fountains.</p>
</section>

  </div>
</StoryLayout>

<script>
(function () {
  const canvas = document.querySelector('.knightscope-canvas') as HTMLCanvasElement | null;
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  if (!ctx) return;

  const ACCENT = '#38bdf8';
  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  let W = 0, H = 0, dpr = 1;

  function resize() {
    dpr = window.devicePixelRatio || 1;
    W = canvas.offsetWidth;
    H = canvas.offsetHeight;
    canvas.width = W * dpr;
    canvas.height = H * dpr;
    ctx.scale(dpr, dpr);
  }

  // Ellipse parameters (fraction of canvas)
  function cx() { return W * 0.5; }
  function cy() { return H * 0.5; }
  function rx() { return W * 0.35; }
  function ry() { return H * 0.30; }

  const ORBIT_SPEED = 0.008; // rad/frame
  const FULL_ORBIT = Math.PI * 2;
  const ORBITS_BEFORE_DESCENT = 2;
  const DESCENT_TARGET_X_FRAC = 0.5;
  const DESCENT_TARGET_Y_FRAC = 0.82;
  const SINK_FRAMES = 60;
  const RIPPLE_COUNT = 6;

  interface Ripple { x: number; y: number; r: number; alpha: number; }

  let angle = -Math.PI / 2;
  let totalAngle = 0;
  let phase: 'orbit' | 'descend' | 'sink' | 'reset' = 'orbit';
  let sinkFrame = 0;
  let orbX = 0, orbY = 0;
  let destX = 0, destY = 0;
  let ripples: Ripple[] = [];

  function resetCycle() {
    angle = -Math.PI / 2;
    totalAngle = 0;
    phase = 'orbit';
    sinkFrame = 0;
    ripples = [];
  }

  function drawStatic() {
    resize();
    ctx.clearRect(0, 0, W, H);
    // draw faint ellipse
    ctx.beginPath();
    ctx.ellipse(cx(), cy(), rx(), ry(), 0, 0, Math.PI * 2);
    ctx.strokeStyle = 'rgba(56,189,248,0.08)';
    ctx.lineWidth = 1;
    ctx.stroke();
    // orb at top
    const ox = cx();
    const oy = cy() - ry();
    ctx.beginPath();
    ctx.arc(ox, oy, 8, 0, Math.PI * 2);
    ctx.fillStyle = ACCENT;
    ctx.fill();
  }

  if (prefersReduced) {
    drawStatic();
    return;
  }

  let rafId: number;
  let frame = 0;

  function draw() {
    frame++;
    ctx.clearRect(0, 0, W, H);

    // faint ellipse guide
    ctx.beginPath();
    ctx.ellipse(cx(), cy(), rx(), ry(), 0, 0, Math.PI * 2);
    ctx.strokeStyle = 'rgba(232,232,232,0.05)';
    ctx.lineWidth = 1;
    ctx.stroke();

    if (phase === 'orbit') {
      angle += ORBIT_SPEED;
      totalAngle += ORBIT_SPEED;
      orbX = cx() + Math.cos(angle) * rx();
      orbY = cy() + Math.sin(angle) * ry();

      if (totalAngle >= FULL_ORBIT * ORBITS_BEFORE_DESCENT) {
        phase = 'descend';
        destX = W * DESCENT_TARGET_X_FRAC;
        destY = H * DESCENT_TARGET_Y_FRAC;
      }
    } else if (phase === 'descend') {
      const wobble = Math.sin(frame * 0.08) * 3;
      orbX += (destX - orbX) * 0.012 + wobble;
      orbY += (destY - orbY) * 0.012;

      if (Math.abs(orbX - destX) < 4 && Math.abs(orbY - destY) < 4) {
        phase = 'sink';
        sinkFrame = 0;
        // spawn ripples
        for (let i = 0; i < RIPPLE_COUNT; i++) {
          ripples.push({ x: orbX, y: orbY, r: 4 + i * 8, alpha: 0.6 - i * 0.08 });
        }
      }
    } else if (phase === 'sink') {
      sinkFrame++;
      const progress = sinkFrame / SINK_FRAMES;

      // draw shrinking orb
      const r = 8 * (1 - progress);
      if (r > 0) {
        ctx.beginPath();
        ctx.arc(orbX, orbY, r, 0, Math.PI * 2);
        ctx.fillStyle = ACCENT;
        ctx.globalAlpha = 1 - progress;
        ctx.fill();
        ctx.globalAlpha = 1;
      }

      // update + draw ripples
      for (const rip of ripples) {
        rip.r += 1.8;
        rip.alpha *= 0.96;
        if (rip.alpha > 0.01) {
          ctx.beginPath();
          ctx.arc(rip.x, rip.y, rip.r, 0, Math.PI * 2);
          ctx.strokeStyle = ACCENT;
          ctx.globalAlpha = rip.alpha;
          ctx.lineWidth = 1;
          ctx.stroke();
          ctx.globalAlpha = 1;
        }
      }

      if (sinkFrame > SINK_FRAMES + 60) {
        resetCycle();
        return;
      }
      rafId = requestAnimationFrame(draw);
      return;
    }

    // draw orb glow
    const grad = ctx.createRadialGradient(orbX, orbY, 0, orbX, orbY, 18);
    grad.addColorStop(0, 'rgba(56,189,248,0.4)');
    grad.addColorStop(1, 'rgba(56,189,248,0)');
    ctx.beginPath();
    ctx.arc(orbX, orbY, 18, 0, Math.PI * 2);
    ctx.fillStyle = grad;
    ctx.fill();

    // draw orb
    ctx.beginPath();
    ctx.arc(orbX, orbY, 8, 0, Math.PI * 2);
    ctx.fillStyle = ACCENT;
    ctx.fill();

    rafId = requestAnimationFrame(draw);
  }

  resize();
  resetCycle();
  rafId = requestAnimationFrame(draw);

  const ro = new ResizeObserver(() => { resize(); });
  ro.observe(canvas);

  window.addEventListener('pagehide', () => {
    cancelAnimationFrame(rafId);
    ro.disconnect();
  });
})();
</script>
